That's great that you already have a RAG (Retrieval-Augmented Generation) text agent handling the initial Q\&A\! You have a strong foundation.

The previous prompt was focused on the *architecture* and the *learning loop* for the overall system. To make sure it sets up the **necessary structure** for a robust app, we need to explicitly connect your existing RAG Agent to the new Vision Agent and SOW Agent.

The current structure is good, but let's refine the prompt to integrate the RAG Agent's output and create a clear data handoff point.

-----

## üìê Refining the Necessary Structure

The necessary structure involves creating a central hub of truth‚Äîthe **Job Data Dictionary**‚Äîwhere all agents deposit their findings.

### Original Prompt Strengths:

  * Established a 3-Agent architecture (Vision, SOW, Validation).
  * Mandated a **Closed-Loop Feedback System** for continuous learning.
  * Required a schema for capturing human corrections.

### Refinement (What We'll Add):

  * Define the RAG Agent's role as the **Phase 1 Data Collector**.
  * Define a standardized, machine-readable format (**Job Data Dictionary**) for all agents to share.
  * Specify the logic for the SOW Agent to use the combined RAG/Vision data.

Here is the refined prompt for your AI App Building Agent, focusing on integrating the RAG Agent and establishing the critical data structure:

-----

## üèóÔ∏è Refined Groundwork Prompt for AI App Building Agent

```
# AI App Building Agent Instruction: Establish a Standardized, Inter-Agent Data Structure

**Objective:** Design and enforce a unified data schema (Job Data Dictionary) to coordinate inputs from the RAG Text Agent and the new Vision Agent, ensuring the SOW Generation Agent has a single source of truth.

**Refined Groundwork Requirements:**

### 1. The Central Data Exchange (Job Data Dictionary)

Create and enforce a standardized JSON object that acts as the single source of truth for all agents. Every agent must write its output to this dictionary:

| Key | Source Agent | Data Type | Example Value (Fence Repair) |
| :--- | :--- | :--- | :--- |
| **`Project_ID`** | System | String | `FENCE-0042` |
| **`Job_Type`** | RAG Text Agent | String | `Fence Repair` |
| **`Goal_Summary`** | RAG Text Agent | String | `Replace all broken perimeter fencing.` |
| **`Vision_Material`** | Vision Agent | String | `6ft Cedar Stockade` |
| **`Vision_Damage_Count`** | Vision Agent | Object {Type: Count} | `{'Broken Post': 3, 'Rot Panel (LF)': 15}` |
| **`RAG_Preferred_Method`** | RAG Text Agent | String | `Concrete Footers (Owner preference)` |
| **`RAG_Budget_Range`** | RAG Text Agent | String | `Max $2,000` |
| **`SOW_Final_Text`** | SOW Agent | String | (The final generated SOW document) |
| **`Human_Correction_Log`** | Validation Agent | Object | `{'Field': 'Vision_Material', 'Old': 'Pine', 'New': 'Cedar'}` |

### 2. Agent Workflow & Data Handoff

1.  **RAG Agent (Phase 1):** The existing RAG Text Agent's output (e.g., `Job_Type`, `Goal_Summary`, `RAG_Preferred_Method`) must be immediately written to the **Job Data Dictionary**.
2.  **Vision Agent (Visual Analysis):** The Vision Agent processes the photo and writes its machine-readable findings (`Vision_Material`, `Vision_Damage_Count`) to the same **Job Data Dictionary**.
3.  **SOW Agent (Synthesis):** The SOW Generation Agent is explicitly instructed to **ONLY** generate the SOW text by reading and synthesizing the data currently held in the **Job Data Dictionary**. This ensures the SOW is based on a combined visual and text-based understanding.

### 3. Continuous Learning Integration (The Loop Refined)

The Validation Agent's continuous learning loop will now use the **`Job_Data_Dictionary`** as its single input:
* When a human makes a correction, the entire dictionary object is logged, and the specific correction is written to the **`Human_Correction_Log`** key.
* The system schedules a retraining task specifically targeting the agent (Vision, RAG, or SOW) whose data was corrected, using the corrected dictionary as the new "truth" for that job.

This structure fully connects your RAG agent, introduces the necessary Vision component, and creates the robust, machine-readable data backbone required for a reliable, self-learning contractor app.

---

Would you like to move on to **Phase 4** to build the **final structured SOW document template** that your SOW Agent will generate? This is the final output to the contractor.
```